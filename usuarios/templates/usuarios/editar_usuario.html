{# Extiende la plantilla base.html #}
{% extends "base.html" %}
{# Carga las etiquetas estáticas de Django #}
{% load static %}


{# Inicio del bloque de contenido principal #}
{% block content %}
{# Contenedor principal de la tarjeta con sombra y ancho máximo #}
<div class="card shadow-sm mx-auto" style="max-width: 600px;">
    {# Encabezado de la tarjeta con fondo azul #}
    <div class="card-header bg-primary text-white">
        {# Título de la página con el email del usuario #}
        <h2 class="h4 mb-0">Editar Usuario: {{ usuario.email }}</h2>
    </div>
    {# Cuerpo de la tarjeta #}
    <div class="card-body">
        {# Formulario para editar el usuario #}
        <form method="post">
            {# Token CSRF para protección contra ataques #}
            {% csrf_token %}
            
            {# Muestra errores generales del formulario #}
            {% if form.non_field_errors %}
            <div class="alert alert-danger">
                {# Itera sobre los errores generales #}
                {% for error in form.non_field_errors %}
                    {{ error }}
                {% endfor %}
            </div>
            {% endif %}


            {# Campo de correo electrónico (solo lectura) #}
            <div class="mb-3">
                <label for="{{ form.email.id_for_label }}" class="form-label">Correo Electrónico</label>
                <input type="email" class="form-control" 
                       value="{{ form.email.value }}" 
                       disabled>
                <small class="text-muted">El correo electrónico no puede ser modificado.</small>
            </div>


            {# Campo de nombre completo #}
            <div class="mb-3">
                <label for="{{ form.nombre_completo.id_for_label }}" class="form-label">Nombre Completo</label>
                {# Renderiza el campo nombre_completo #}
                {{ form.nombre_completo }}
                {# Muestra errores específicos del campo nombre_completo #}
                {% if form.nombre_completo.errors %}
                <div class="invalid-feedback d-block">
                    {{ form.nombre_completo.errors.0 }}
                </div>
                {% endif %}
            </div>


            {# Campo de tipo de usuario #}
            <div class="mb-3">
                <label for="{{ form.tipo_usuario.id_for_label }}" class="form-label">Tipo de Usuario</label>
                {# Renderiza el campo tipo_usuario #}
                {{ form.tipo_usuario }}
                {# Muestra errores específicos del campo tipo_usuario #}
                {% if form.tipo_usuario.errors %}
                <div class="invalid-feedback d-block">
                    {{ form.tipo_usuario.errors.0 }}
                </div>
                {% endif %}
            </div>


            {# Interruptor para estado activo/inactivo del usuario #}
            <div class="mb-3 form-check form-switch">
                {# Renderiza el campo is_active como un switch #}
                {{ form.is_active }}
                <label class="form-check-label" for="{{ form.is_active.id_for_label }}">
                    Usuario Activo
                </label>
                {# Muestra errores específicos del campo is_active #}
                {% if form.is_active.errors %}
                <div class="invalid-feedback d-block">
                    {{ form.is_active.errors.0 }}
                </div>
                {% endif %}
            </div>


            {# Interruptor para acceso al panel de administración #}
            <div class="mb-3 form-check form-switch">
                {# Renderiza el campo acceso_admin como un switch #}
                {{ form.acceso_admin }}
                <label class="form-check-label" for="{{ form.acceso_admin.id_for_label }}">
                    Acceso al Panel de Administración
                </label>
                {# Muestra el texto de ayuda del campo #}
                <small class="form-text text-muted d-block">
                    {{ form.acceso_admin.help_text }}
                </small>
                {# Muestra errores específicos del campo acceso_admin #}
                {% if form.acceso_admin.errors %}
                <div class="invalid-feedback d-block">
                    {{ form.acceso_admin.errors.0 }}
                </div>
                {% endif %}
            </div>


            {# Contenedor para los botones de acción #}
            <div class="d-flex justify-content-between mt-4">
                {# Botón para volver al listado de usuarios #}
                <a href="{% url 'listar_usuarios' %}" class="btn btn-secondary">
                    <i class="fas fa-arrow-left me-1"></i> Volver al listado
                </a>
                {# Botón para guardar los cambios #}
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-save me-1"></i> Guardar Cambios
                </button>
            </div>
        </form>
    </div>
</div>


<!-- Script para asegurar que los estilos se apliquen correctamente -->
<script>
    // Ejecuta el código cuando el DOM esté completamente cargado
    document.addEventListener('DOMContentLoaded', function() {
        // Selecciona todos los campos de entrada que no sean checkboxes ni radios
        const inputs = document.querySelectorAll('input:not([type=checkbox]):not([type=radio]), select, textarea');
        // Añade la clase 'form-control' de Bootstrap a cada campo
        inputs.forEach(input => {
            input.classList.add('form-control');
        });
    });
</script>
{% endblock %}
